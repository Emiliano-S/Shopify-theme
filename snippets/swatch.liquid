{% comment %}
  Set the extension of your color files below. Use 'png', 'jpeg', 'jpg' or 'gif'.
{% endcomment %}

{% assign file_extension = 'png' %}

{% if swatch == blank %}
  <div class="swatch error">
    <p>You must include the snippet swatch.liquid with the name of a product option.</p>
    <p>Use:
      <code>
        {% raw %}
          {% include 'swatch' with 'name of your product option here' %}{% endraw %}
      </code>
    </p>
    <p>Example:
      <code>
        {% raw %}
          {% include 'swatch' with 'Color' %}{% endraw %}
      </code>
    </p>
  </div>
{% else %}

  {% assign found_option = false %}
  {% assign is_color = false %}
  {% assign option_index = 0 %}
  {% assign base_price = product.variants.first.price %}
  {% assign base_quantity = product.variants.first.option1 | plus: 0 %}

  {% for option in product.options %}
    {% if option == swatch %}
      {% assign found_option = true %}
      {% assign option_index = forloop.index0 %}
      <style>
        label[for="product-select-option-{{ option_index }}"] {
          display: none;
        }
        #product-select-option-{{ option_index }} {
          display: none;
        }
        #product-select-option-{{ option_index }}
        + .custom-style-select-box {
          display: none !important;
        }
      </style>
      <script>
        $(window).load(function() { $('.selector-wrapper:eq({{ option_index }})').hide(); });
      </script>
      {% assign downcased_option = swatch | downcase %}
      {% if downcased_option contains 'color' or downcased_option contains 'colour' %}
        {% assign is_color = true %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% unless found_option %}
    <div class="swatch error">
      <p>You included the snippet swatch.liquid with the name of a product option —
        <code>'{{ swatch }}'</code>
        — that does not belong to your product.</p>
      <p>Use
        <code>
          {% raw %}
            {% include 'swatch' with 'name of your product option here' %}{% endraw %}
        </code>
      </p>
      <p>Example:
        <code>
          {% raw %}
            {% include 'swatch' with 'Color' %}{% endraw %}
        </code>
      </p>
      <p>
        <strong>This is case-sensitive!</strong>
        Do not put in
        <code>'color'</code>
        if your product option name is
        <code>'Color'</code>.</p>
    </div>
  {% else %}
    <div class="swatch clearfix" data-option-index="{{ option_index }}">
      {% comment %} <div class="header">{{ swatch }}</div> {% endcomment %}
      {% assign values = '' %}
      <div class="swatch-options-container">
        {% for variant in product.variants %}
          {% assign value = variant.options[option_index] %}
          {% assign test = value %}
          {% unless values contains value %}
            {% assign values = values | join: ',' %}
            {% assign values = values | append: ',' | append: value %}
            {% assign values = values | split: ',' %}

            {% assign current_quantity = value | plus: 0 %}
            {% assign expected_price = base_price | times: current_quantity | divided_by: base_quantity %}
            {% assign discount_ratio = variant.price | times: 100 | divided_by: expected_price %}
            {% assign discount_percentage = 100 | minus: discount_ratio | round %}

            <div data-value="{{ value | escape }}" class="swatch-element {% if is_color and section.settings.swatch_option == 'with_background' %}color with_bg_color {% elsif is_color and section.settings.swatch_option == 'without_background'%}color color_without_bg {% endif %}{% if is_color and section.settings.color_style == 'square_box' %}square_shape {% elsif is_color and section.settings.color_style == 'round_shape'%}round_shape{% endif %}{{ swatch }} {{ value | handle }} {% if variant.available %}available{% else %}soldout{% endif %}">
              {% if is_color and section.settings.swatch_option == 'with_background' %}
                <div class="tooltip">{{ value }}</div>
              {% endif %}
              <input
                id="swatch-{{ option_index }}-{{ value | handle }}"
                type="radio"
                name="option-{{ option_index }}"
                value="{{ value | escape }}"
                {% if forloop.first %}
                {% unless section.settings.enable_default_variant %}
                checked{% endunless %}
                {% endif %}
                {% unless variant.available %}
                disabled{% endunless %} />
              {% if is_color and section.settings.swatch_option == 'with_background' %}
                <label for="swatch-{{ option_index }}-{{ value | handle }}" style="background-color: {{ value | split: ' ' | last | handle }}; background-image: url({{ value | handle | append: '.' | append: file_extension | asset_url }})">
                  <img class="crossed-out" src="{{ 'soldout.png' | asset_url }}" />
                </label>
              {% else %}
                <label for="swatch-{{ option_index }}-{{ value | handle }}">
                  <div class="swatch-price">
                    {{ value }}
                  </div>
                  <div class="swatch-text">{{ discount_percentage }}% de <br> descuento</div>
                  <img class="crossed-out" src="{{ 'soldout.png' | asset_url }}" />
                </label>
              {% endif %}
            </div>
          {% endunless %}
          {% if variant.available %}
            <script>
                    jQuery('.swatch[data-option-index="{{ option_index }}"] .{{ value | handle }}').removeClass('soldout').addClass('available').find(':radio').removeAttr('disabled');
            </script>
          {% endif %}
        {% endfor %}
      </div>
      <div id="infiniteoptions-container">
        <div class="TEST">
          <label for="URL PERFIL SEGUIDORES-0-0" class="spb-productdescfont spb-productdesctextcolor">Introduce aquí tu perfil de Instagram</label>
          <span>
            <input
              type="text"
              name="properties[URL PERFIL SEGUIDORES]"
              id="URL PERFIL SEGUIDORES-0-0"
              class="spb-productdescfont spb-productoptiontextcolor spb-productoptionbackground"
              placeholder="URL de tu PERFIL de INSTAGRAM"
              maxlength="60"
              size="60"
              required="">
          </span>
        </div>
      </div>
    </div>

  {% endunless %}

{% endif %}

<script>
  console.log("Product Variants: ", JSON.stringify({{ product.variants | json }}));
</script>